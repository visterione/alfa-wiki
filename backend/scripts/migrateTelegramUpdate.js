/**
 * ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ telegram_subscribers
 * Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº
 * 
 * Ğ—Ğ°Ğ¿ÑƒÑĞº: node scripts/migrateTelegramUpdate.js
 */

require('dotenv').config();
const { sequelize } = require('../models');

async function migrate() {
  try {
    console.log('ğŸ”„ Connecting to database...');
    await sequelize.authenticate();
    console.log('âœ… Connected to database');

    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ
    console.log('ğŸ”„ Adding subscription fields...');
    
    await sequelize.query(`
      ALTER TABLE telegram_subscribers 
      ADD COLUMN IF NOT EXISTS "subscribeAccreditations" BOOLEAN DEFAULT true;
    `);
    
    await sequelize.query(`
      ALTER TABLE telegram_subscribers 
      ADD COLUMN IF NOT EXISTS "subscribeVehicles" BOOLEAN DEFAULT true;
    `);

    console.log('âœ… Subscription fields added');

    console.log('\nğŸ‰ Migration completed successfully!\n');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('  Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸:');
    console.log('  â€¢ subscribeAccreditations - ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ°ĞºĞºÑ€ĞµĞ´Ğ¸Ñ‚Ğ°Ñ†Ğ¸ÑÑ…');
    console.log('  â€¢ subscribeVehicles - ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ Ñ‚ĞµÑ…Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğ¸');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

    process.exit(0);
  } catch (error) {
    console.error('âŒ Migration failed:', error);
    process.exit(1);
  }
}

migrate();